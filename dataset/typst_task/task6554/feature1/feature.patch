From d8ee74f5d31c0ecfba08d375a4d5229776032eac Mon Sep 17 00:00:00 2001
From: Malo <57839069+MDLC01@users.noreply.github.com>
Date: Thu, 3 Jul 2025 22:47:11 +0100
Subject: [PATCH 1/3] Add `default` argument for `str.first` and `str.last`

---
 crates/typst/src/foundations/str.rs | 26 ++++++++++++++++-----
 1 file changed, 20 insertions(+), 6 deletions(-)

diff --git a/crates/typst/src/foundations/str.rs b/crates/typst/src/foundations/str.rs
index 23a1bd4cfda5..015716b94044 100644
--- a/crates/typst/src/foundations/str.rs
+++ b/crates/typst/src/foundations/str.rs
@@ -178,25 +178,39 @@ impl Str {
         self.0.len()
     }
 
-    /// Extracts the first grapheme cluster of the string.
-    /// Fails with an error if the string is empty.
+    /// Extracts the first grapheme cluster of the string. Fails with an error
+    /// if the string is empty. Returns the default value if the string is empty
+    /// or fails with an error is no default value was specified.
     #[func]
-    pub fn first(&self) -> StrResult<Str> {
+    pub fn first(
+        &self,
+        /// A default value to return if the string is empty.
+        #[named]
+        default: Option<Str>,
+    ) -> StrResult<Str> {
         self.0
             .graphemes(true)
             .next()
             .map(Into::into)
+            .or(default)
             .ok_or_else(string_is_empty)
     }
 
-    /// Extracts the last grapheme cluster of the string.
-    /// Fails with an error if the string is empty.
+    /// Extracts the last grapheme cluster of the string. Fails with an error if
+    /// the string is empty. Returns the default value if the string is empty or
+    /// fails with an error is no default value was specified.
     #[func]
-    pub fn last(&self) -> StrResult<Str> {
+    pub fn last(
+        &self,
+        /// A default value to return if the string is empty.
+        #[named]
+        default: Option<Str>,
+    ) -> StrResult<Str> {
         self.0
             .graphemes(true)
             .next_back()
             .map(Into::into)
+            .or(default)
             .ok_or_else(string_is_empty)
     }
 

From 1853b10927bbbdc8dccb8e9d8728b03b969ea3f7 Mon Sep 17 00:00:00 2001
From: Laurenz <laurmaedje@gmail.com>
Date: Wed, 9 Jul 2025 14:06:15 +0200
Subject: [PATCH 3/3] Fix docs

---
 crates/typst/src/foundations/str.rs | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/crates/typst/src/foundations/str.rs b/crates/typst/src/foundations/str.rs
index 015716b94044..e500b1a4d32c 100644
--- a/crates/typst/src/foundations/str.rs
+++ b/crates/typst/src/foundations/str.rs
@@ -178,9 +178,10 @@ impl Str {
         self.0.len()
     }
 
-    /// Extracts the first grapheme cluster of the string. Fails with an error
-    /// if the string is empty. Returns the default value if the string is empty
-    /// or fails with an error is no default value was specified.
+    /// Extracts the first grapheme cluster of the string.
+    ///
+    /// Returns the provided default value if the string is empty or fails with
+    /// an error if no default value was specified.
     #[func]
     pub fn first(
         &self,
@@ -196,9 +197,10 @@ impl Str {
             .ok_or_else(string_is_empty)
     }
 
-    /// Extracts the last grapheme cluster of the string. Fails with an error if
-    /// the string is empty. Returns the default value if the string is empty or
-    /// fails with an error is no default value was specified.
+    /// Extracts the last grapheme cluster of the string.
+    ///
+    /// Returns the provided default value if the string is empty or fails with
+    /// an error if no default value was specified.
     #[func]
     pub fn last(
         &self,
